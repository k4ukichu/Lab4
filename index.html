<html>
    <head>
        <title>Javascript MQTT Websocket></title>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"
type="text/javascript"></script>
<script type="text/javascript"language="javascript">
    var mqtt;
    var reconnectTimeout=2000;
    var host="broker.emqx.io"; //change this
    var port=8083;
    function getLocation() {
              if ('geolocation'in navigator){
                  navigator.geolocation.getCurrentPosition(position =>{
                   console.log(position.coords.latitude);
                   console.log(position.coords.longitude);
                   document.getElementById("latitude").innerHTML=position.coords.latitude;
                   document.getElementById("longitude").innerHTML=position.coords.longitude;

              });
            }
            else{
                document.getElementById("message").innerHTML="Not supportted";
            }
        
        }
            
    function onConnect(){
        //once a conncetion has been made, make a subscription and send a message.
        console.log("connected");
        //mqtt.subscribe("sensor1");
        message=new Paho.MQTT.Message("Hello World");
        message.destinationName="sensor1";
        mqtt.send(message);
    }
    function onFailure(message){
        console.log("Not connected");
        setTimeout(MQTTconnect, reconnectTimeout)
    }
    function onMessageArrived(msg){
        out_msg="message: "+msg+ "Fail";
        console.log(out_msg);
        document.getElementById("message").innerHTML=out_msg;

    }
        function MQTTconnect(){
        console.log("connecting to "+ host+""+port);
        mqtt= new Paho.MQTT.Client(host,port,"mqttx_d306e68c");
        //document.write("connectingto "+ host);
        var options= {
            timeout:3,
            onSuccess:onConnect,
            onFailure: onFailure,
        };
            mqtt.onMessageArrived =onMessageArrived
        
        mqtt.connect(options); //conncet
    }
        </script>
    </head>
    <body>
        <h1>Main Body</h1>
        <h1 id="message"></h1>
        <p>
            latitude: <span id="latitude"></span> &deg;<br/>
            longitude: <span id="longitude"></span>&deg;
        </p>
        <script>
            MQTTconnect();
        </script>
        <button id="location" onclick="getLocation()">Get Location</button>
            
    </body>
</html>